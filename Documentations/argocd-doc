# ArgoCD - Continuous Deployment Documentation

## Overview
ArgoCD is a declarative GitOps continuous delivery tool for Kubernetes. It automatically synchronizes the desired application state defined in Git with the actual state in the Kubernetes cluster, enabling automated deployments and self-healing capabilities.

---

## Project Structure
```
argocd/
â””â”€â”€ application.yaml
```

---

## ArgoCD Application Configuration

### Application Manifest
**File:** `application.yaml`

```yaml
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: final-app
  namespace: argocd
spec:
  project: default
  source:
    repoURL: 'https://github.com/OMAR-BESHIR/k8s-manifests.git'
    targetRevision: main
    path: .
  destination:
    server: 'https://kubernetes.default.svc'
    namespace: ivolve
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
```

---

## Configuration Breakdown

### Metadata Section
```yaml
metadata:
  name: final-app
  namespace: argocd
```

| Field | Value | Description |
|-------|-------|-------------|
| **name** | final-app | Application name in ArgoCD |
| **namespace** | argocd | ArgoCD namespace (where ArgoCD is installed) |

---

### Source Section
```yaml
source:
  repoURL: 'https://github.com/OMAR-BESHIR/k8s-manifests.git'
  targetRevision: main
  path: .
```

| Field | Value | Description |
|-------|-------|-------------|
| **repoURL** | GitHub repository URL | Git repository containing Kubernetes manifests |
| **targetRevision** | main | Git branch to track |
| **path** | . | Path within repository (root directory) |

**Purpose:** Defines where ArgoCD should pull Kubernetes manifests from.

---

### Destination Section
```yaml
destination:
  server: 'https://kubernetes.default.svc'
  namespace: ivolve
```

| Field | Value | Description |
|-------|-------|-------------|
| **server** | kubernetes.default.svc | Kubernetes cluster API server (in-cluster) |
| **namespace** | ivolve | Target namespace for deployment |

**Purpose:** Specifies where the application will be deployed.

---

### Sync Policy Section
```yaml
syncPolicy:
  automated:
    prune: true
    selfHeal: true
```

| Field | Value | Description |
|-------|-------|-------------|
| **automated** | enabled | Enables automatic synchronization |
| **prune** | true | Automatically deletes resources removed from Git |
| **selfHeal** | true | Automatically corrects manual changes in cluster |

**Features:**
- **Auto-Sync:** Automatically deploys changes from Git
- **Prune:** Removes resources not in Git repository
- **Self-Heal:** Reverts manual changes to match Git state

---

## Setup Instructions

### Prerequisites
```bash
# Kubernetes cluster running
kubectl cluster-info

# Namespace 'ivolve' must exist
kubectl get namespace ivolve
```

### Step 1: Install ArgoCD

```bash
# Create ArgoCD namespace
kubectl create namespace argocd

# Install ArgoCD
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# Wait for ArgoCD to be ready
kubectl wait --for=condition=available --timeout=600s deployment/argocd-server -n argocd
```

**Verify Installation:**
```bash
kubectl get pods -n argocd
```

---

### Step 2: Access ArgoCD UI

#### Option A: Port Forward (For Testing)
```bash
kubectl port-forward svc/argocd-server -n argocd 8080:443
```

**Access at:** `https://localhost:8080`

#### Option B: LoadBalancer (For Production)
```bash
kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'
```

**Get External IP:**
```bash
kubectl get svc argocd-server -n argocd
```

---

### Step 3: Get Initial Admin Password

```bash
# Get initial admin password
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d && echo

# Login credentials:
# Username: admin
# Password: <output from above command>
```

---

### Step 4: Install ArgoCD CLI (Optional)

```bash
# Download ArgoCD CLI
curl -sSL -o argocd-linux-amd64 https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64

# Install CLI
sudo install -m 555 argocd-linux-amd64 /usr/local/bin/argocd

# Verify installation
argocd version
```

---

### Step 5: Login via CLI (Optional)

```bash
# Login to ArgoCD
argocd login <ARGOCD_SERVER> --username admin --password <PASSWORD>

# Example (if using port-forward):
argocd login localhost:8080 --username admin --password <PASSWORD> --insecure
```

---

### Step 6: Deploy Application

#### Option A: Using kubectl
```bash
kubectl apply -f application.yaml
```

#### Option B: Using ArgoCD CLI
```bash
argocd app create final-app \
  --repo https://github.com/OMAR-BESHIR/k8s-manifests.git \
  --path . \
  --dest-server https://kubernetes.default.svc \
  --dest-namespace ivolve \
  --sync-policy automated \
  --auto-prune \
  --self-heal
```

---

### Step 7: Verify Deployment

```bash
# Check application status
kubectl get applications -n argocd

# View application details
kubectl describe application final-app -n argocd

# Check deployed resources in target namespace
kubectl get all -n ivolve
```

---

## ArgoCD CLI Commands

### View Applications
```bash
# List all applications
argocd app list

# Get application details
argocd app get final-app
```

### Sync Operations
```bash
# Manual sync
argocd app sync final-app

# Sync with prune
argocd app sync final-app --prune
```

### Application Management
```bash
# Delete application
argocd app delete final-app

# Refresh application (detect changes)
argocd app refresh final-app

# View application history
argocd app history final-app
```

### Rollback Operations
```bash
# Rollback to previous version
argocd app rollback final-app

# Rollback to specific revision
argocd app rollback final-app <REVISION_ID>
```

---

## GitOps Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Developer                         â”‚
â”‚                                                     â”‚
â”‚  1. Push code to GitHub                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Jenkins CI                        â”‚
â”‚                                                     â”‚
â”‚  2. Build Docker image                              â”‚
â”‚  3. Push to DockerHub                               â”‚
â”‚  4. Update k8s-manifests repo                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GitHub (Manifests Repo)                â”‚
â”‚                                                     â”‚
â”‚  5. deployment.yml updated with new image tag       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ArgoCD                           â”‚
â”‚                                                     â”‚
â”‚  6. Detects changes in Git repository               â”‚
â”‚  7. Automatically syncs to Kubernetes               â”‚
â”‚  8. Deploys updated application                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Cluster                     â”‚
â”‚                                                     â”‚
â”‚  9. Application running with new version            â”‚
â”‚  10. Self-healing enabled                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Monitoring & Troubleshooting

### Check Application Health
```bash
# ArgoCD UI: Applications â†’ final-app
# Shows: Healthy | Progressing | Degraded | Suspended

# CLI:
argocd app get final-app
```

### View Sync Status
```bash
# Check if application is in sync
kubectl get application final-app -n argocd -o jsonpath='{.status.sync.status}'

# Expected output: Synced
```

### View Application Events
```bash
# View ArgoCD events
kubectl get events -n argocd --sort-by='.lastTimestamp'

# View application logs
kubectl logs -n argocd deployment/argocd-application-controller
```

### Common Issues

#### Issue: Application stuck in "OutOfSync"
```bash
# Force refresh
argocd app refresh final-app

# Manual sync
argocd app sync final-app
```

#### Issue: Application health "Progressing"
```bash
# Check pod status in target namespace
kubectl get pods -n ivolve

# Describe pods for errors
kubectl describe pod <pod-name> -n ivolve
```

#### Issue: Self-heal not working
```bash
# Verify sync policy
kubectl get application final-app -n argocd -o yaml | grep -A5 syncPolicy

# Ensure automated sync is enabled
```

---

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Git Repository (Source of Truth)        â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   k8s-manifests Repository                   â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ deployment.yml                         â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ service.yml                            â”‚ â”‚
â”‚  â”‚   â””â”€â”€ namespace.yml                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Monitors for changes
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ArgoCD                          â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Application Controller                     â”‚ â”‚
â”‚  â”‚   â€¢ Monitors Git repository                  â”‚ â”‚
â”‚  â”‚   â€¢ Compares desired vs actual state         â”‚ â”‚
â”‚  â”‚   â€¢ Triggers sync operations                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Applies manifests
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetes Cluster                    â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Namespace: ivolve                          â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ Deployment: flask-app                  â”‚ â”‚
â”‚  â”‚   â”œâ”€â”€ Service: flask-service                 â”‚ â”‚
â”‚  â”‚   â””â”€â”€ Pods: Running application              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Best Practices Applied

âœ… **GitOps Methodology:** Git as single source of truth  
âœ… **Automated Sync:** Continuous deployment without manual intervention  
âœ… **Self-Healing:** Automatically corrects configuration drift  
âœ… **Prune Resources:** Removes deleted resources from cluster  
âœ… **Declarative Configuration:** Infrastructure and application state in Git  
âœ… **Audit Trail:** Complete history of deployments in Git

---

## Security Considerations

ğŸ”’ **RBAC:** Configure proper role-based access control  
ğŸ”’ **Private Repos:** Use SSH keys or tokens for private repositories  
ğŸ”’ **Namespace Isolation:** Deploy applications in dedicated namespaces  
ğŸ”’ **Secret Management:** Use sealed secrets or external secret operators  
ğŸ”’ **TLS:** Enable HTTPS for ArgoCD UI access  
ğŸ”’ **SSO:** Integrate with identity providers for authentication

---

## Advantages of Using ArgoCD

âœ¨ **Automated Deployments:** No manual kubectl commands needed  
âœ¨ **Version Control:** Complete deployment history in Git  
âœ¨ **Rollback Capability:** Easy rollback to previous versions  
âœ¨ **Multi-Cluster Support:** Manage multiple clusters from single interface  
âœ¨ **Visual UI:** See application state and health at a glance  
âœ¨ **Audit Trail:** Track who deployed what and when  
âœ¨ **Consistency:** Same deployment process across environments

---

## Additional Notes

ğŸ“ Repository must be accessible by ArgoCD  
ğŸ“ Kubernetes manifests must be valid YAML  
ğŸ“ Target namespace must exist before sync  
ğŸ“ Changes in Git automatically trigger deployment  
ğŸ“ Manual cluster changes are reverted by self-heal  
ğŸ“ Application health depends on underlying resources  
ğŸ“ ArgoCD polls Git repository every 3 minutes by default

---

## Integration with CI Pipeline

This ArgoCD setup completes the GitOps workflow:

1. **Jenkins CI** builds and pushes Docker image
2. **Jenkins** updates Kubernetes manifests in Git
3. **ArgoCD** detects manifest changes
4. **ArgoCD** automatically deploys to cluster
5. **Self-heal** ensures cluster state matches Git

**Result:** Fully automated CI/CD pipeline! 
